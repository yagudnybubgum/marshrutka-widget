# Инструкция по деплою в Coolify

## Шаг 0: Настройка сервера в Coolify (ОБЯЗАТЕЛЬНО!)

**Если видишь ошибку "No validated & reachable servers found":**

1. **Перейди на страницу серверов:**
   - Нажми на ссылку "Go to servers page" или найди в меню "Servers"

2. **Добавь новый сервер:**
   - Нажми кнопку "Add Server" или "Добавить сервер"
   - Выбери тип сервера:
     - **Local Server** - если Coolify установлен на том же сервере, где будешь деплоить
     - **Remote Server** - если Coolify на другом сервере

3. **Настройка Local Server (если Coolify на том же сервере):**
   - Имя: любое (например, "My Server")
   - Coolify автоматически определит сервер
   - Нажми "Save"

4. **Настройка Remote Server (если сервер отдельно):**
   - **Имя**: любое (например, "Production Server")
   - **IP адрес**: IP твоего сервера (например, `123.45.67.89`)
   - **Порт SSH**: обычно `22`
   - **Пользователь**: обычно `root` или твой пользователь
   - **Метод аутентификации**:
     - **SSH Key** (рекомендуется) - добавь свой SSH ключ
     - **Password** - введи пароль
   
   - Нажми "Validate" - Coolify проверит подключение
   - Если валидация успешна, нажми "Save"

5. **После добавления сервера:**
   - Сервер должен появиться в списке
   - Статус должен быть "Validated" или "Reachable"
   - Теперь можно возвращаться к созданию ресурса

## Шаг 1: Подготовка сервера

1. Установи Coolify на свой сервер (если еще не установлен)
   - Следуй официальной инструкции: https://coolify.io/docs

2. Убедись, что у тебя есть:
   - Домен (опционально, но рекомендуется)
   - SSH доступ к серверу

## Шаг 2: Настройка проекта в Coolify

### 2.1 Создание нового ресурса

1. Зайди в Coolify панель управления
2. Нажми "New Resource" или "Новый ресурс"
3. Выбери "Docker Compose" или "Standalone Dockerfile"

### 2.2 Подключение репозитория

**Вариант A: Через Git (рекомендуется)**

1. Выбери "Git Repository"
2. Подключи свой GitHub/GitLab репозиторий
3. Укажи ветку (обычно `main` или `master`)
4. Coolify автоматически обнаружит Dockerfile

**Вариант B: Через Dockerfile напрямую**

1. Выбери "Dockerfile"
2. Загрузи файлы проекта или подключи через Git

### 2.3 Настройка сборки

Coolify автоматически обнаружит Dockerfile, но проверь:

- **Build Command**: не нужен (используется Dockerfile)
- **Dockerfile Path**: `Dockerfile` (по умолчанию)
- **Docker Context**: `.` (корень проекта)

### 2.4 Настройка портов

- **Port**: `80` (nginx слушает на порту 80)
- Coolify автоматически настроит проксирование

### 2.5 Переменные окружения

Для этого проекта переменные окружения не требуются, но если понадобятся:
- Добавь их в раздел "Environment Variables"

## Шаг 3: Домен и SSL

1. В настройках ресурса найди раздел "Domains"
2. Добавь свой домен (например: `marshrutka.example.com`)
3. Coolify автоматически настроит SSL через Let's Encrypt

## Шаг 4: Деплой

1. Нажми "Deploy" или "Deploy Now"
2. Coolify:
   - Склонирует репозиторий (если через Git)
   - Соберет Docker образ
   - Запустит контейнер
   - Настроит проксирование

## Шаг 5: Проверка

1. Открой свой домен в браузере
2. Проверь, что приложение работает
3. В логах Coolify можно увидеть процесс сборки и запуска

## Обновление приложения

После каждого push в репозиторий:
- Coolify автоматически пересоберет и перезапустит приложение (если настроен webhook)
- Или нажми "Redeploy" вручную

## Troubleshooting

### Приложение не запускается

1. Проверь логи в Coolify: "Logs" → "Application Logs"
2. Убедись, что Dockerfile корректен
3. Проверь, что порт 80 открыт

### Статические файлы не загружаются

1. Проверь, что файлы в папке `public/` копируются в `dist/`
2. Проверь nginx конфигурацию

### Проблемы с роутингом

- nginx.conf уже настроен для SPA роутинга
- Все запросы должны идти на `/index.html`

## Полезные команды (если нужен SSH доступ)

```bash
# Проверить статус контейнера
docker ps

# Посмотреть логи
docker logs <container_id>

# Зайти в контейнер
docker exec -it <container_id> sh
```

